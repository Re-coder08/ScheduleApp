{% extends 'base.html' %}

{% block content %}

<h1>Appointment Booking : </h1>
{% include 'messages.html' %}
<form class="text-center" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    
    <button class="text-center btn btn-primary" type="submit">Continue</button>
</form>



<!-- Dont remoev these scripts from here... they are used to get the slots values dynamically -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
<script>
$(document).ready(function() {
    $('#id_booking_date').on('change', function() {
        
        var duration = $('#id_duration').val();
        var staff_id = $('#id_staff').val();
        var booking_date = $('#id_booking_date').val();

        console.log(booking_date, staff_id, duration);
        if (  booking_date != null & staff_id != null) {
            $.ajax({
                url: '/booking/BookAppointment/Timeslot/',
                async: !1,
                data: {'staff_id': staff_id, 'booking_date': booking_date, 'duration':duration},
                success: function(data) {
                    console.log(data)
                    $('#id_start_time').html(data);
                }
            });
        } else {
            $('#id_start_time').empty();
        }
    });

    $('#id_staff').on('change', function() {
        
        var duration = $('#id_duration').val();
        var staff_id = $('#id_staff').val();
        var booking_date = $('#id_booking_date').val();

        console.log(booking_date, staff_id, duration);
        if (  booking_date != null & staff_id != null) {
            $.ajax({
                url: '/booking/BookAppointment/Timeslot/',
                async: !1,
                data: {'staff_id': staff_id, 'booking_date': booking_date, 'duration':duration},
                success: function(data) {
                    console.log(data)
                    $('#id_start_time').html(data);
                }
            });
        } else {
            $('#id_start_time').empty();
        }
    });

    $('#id_duration').on('change', function() {
        
        var duration = $('#id_duration').val();
        var staff_id = $('#id_staff').val();
        var booking_date = $('#id_booking_date').val();

        console.log(booking_date, staff_id, duration);
        if (  booking_date != null & staff_id != null) {
            $.ajax({
                url: '/booking/BookAppointment/Timeslot/',
                async: !1,
                data: {'staff_id': staff_id, 'booking_date': booking_date, 'duration':duration},
                success: function(data) {
                    console.log(data)
                    $('#id_start_time').html(data);
                }
            });
        } else {
            $('#id_start_time').empty();
        }
    });
});
</script>
{% endblock %}
